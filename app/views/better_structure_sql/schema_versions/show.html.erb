<div class="row">
  <div class="col-12">
    <!-- Header with Back Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="h2">
        <i class="bi bi-file-earmark-code text-primary"></i>
        Schema Version #<%= @schema_version.id %>
      </h1>
      <a href="<%= better_structure_sql.schema_versions_path %>" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i>
        Back to List
      </a>
    </div>

    <!-- Metadata Card -->
    <div class="card metadata-card shadow-sm mb-4">
      <div class="card-body">
        <div class="row">
          <div class="col-md-3">
            <h6 class="text-muted mb-1">
              <i class="bi bi-hash"></i>
              Version ID
            </h6>
            <p class="mb-0 fw-bold">#<%= @schema_version.id %></p>
          </div>
          <div class="col-md-3">
            <h6 class="text-muted mb-1">
              <i class="bi bi-filetype-sql"></i>
              Format
            </h6>
            <p class="mb-0">
              <%= format_type_badge(@schema_version.format_type) %>
            </p>
          </div>
          <div class="col-md-3">
            <h6 class="text-muted mb-1">
              <i class="bi bi-folder"></i>
              Output Mode
            </h6>
            <p class="mb-0">
              <%= format_output_mode(@schema_version.output_mode) %>
            </p>
          </div>
          <div class="col-md-3">
            <h6 class="text-muted mb-1">
              <i class="bi bi-server"></i>
              PostgreSQL Version
            </h6>
            <p class="mb-0"><%= @schema_version.pg_version %></p>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-md-3">
            <h6 class="text-muted mb-1">
              <i class="bi bi-calendar-event"></i>
              Created
            </h6>
            <p class="mb-0">
              <%= @schema_version.created_at.strftime('%Y-%m-%d %H:%M:%S') %>
              <small class="text-muted d-block">
                <%= time_ago_in_words(@schema_version.created_at) %> ago
              </small>
            </p>
          </div>
          <div class="col-md-3">
            <h6 class="text-muted mb-1">
              <i class="bi bi-file-earmark-bar-graph"></i>
              Size
            </h6>
            <p class="mb-0">
              <span class="badge bg-secondary"><%= @schema_version.formatted_size %></span>
            </p>
          </div>
          <div class="col-md-3">
            <h6 class="text-muted mb-1">
              <i class="bi bi-info-circle"></i>
              Lines
            </h6>
            <p class="mb-0"><%= number_with_delimiter(@schema_version.line_count) %> lines</p>
          </div>
          <div class="col-md-3">
            <h6 class="text-muted mb-1">
              <i class="bi bi-files"></i>
              Files
            </h6>
            <p class="mb-0">
              <% if @schema_version.file_count %>
                <span class="badge bg-light text-dark"><%= @schema_version.file_count %> files</span>
              <% else %>
                <span class="text-muted">1 file</span>
              <% end %>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="mb-3">
      <a href="<%= better_structure_sql.download_schema_version_path(@schema_version) %>"
         class="btn btn-primary btn-lg"
         data-turbo="false">
        <% if @schema_version.multi_file? %>
          <i class="bi bi-file-zip"></i>
          Download ZIP Archive
        <% else %>
          <i class="bi bi-download"></i>
          Download File
        <% end %>
      </a>
      <% if @schema_version.respond_to?(:content) && @schema_version.content.present? %>
        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="copyToClipboard()">
          <i class="bi bi-clipboard"></i>
          Copy to Clipboard
        </button>
      <% end %>
    </div>

    <!-- Multi-file Info -->
    <% if @schema_version.multi_file? && @manifest %>
      <div class="alert alert-info mb-4">
        <h6 class="alert-heading">
          <i class="bi bi-info-circle"></i>
          Multi-File Schema
        </h6>
        <p class="mb-2">This schema was generated in multi-file format with <%= @schema_version.file_count %> files across organized directories.</p>
        <% if @manifest['directories'] %>
          <p class="mb-0 small">
            <strong>Directories:</strong>
            <%= @manifest['directories'].keys.sort.join(', ') %>
          </p>
        <% end %>
      </div>
    <% end %>

    <!-- Schema Content -->
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h5 class="card-title mb-0">
          <i class="bi bi-code-square"></i>
          Schema Content
          <% if @schema_version.multi_file? %>
            <small class="text-muted">(combined from all files)</small>
          <% end %>
        </h5>
      </div>
      <div class="card-body p-0">
        <% if @schema_version.respond_to?(:content) && @schema_version.content.present? %>
          <pre class="code-block m-0" id="schema-content"><%= @schema_version.content %></pre>
        <% else %>
          <div class="alert alert-warning m-3">
            <i class="bi bi-exclamation-triangle"></i>
            <strong>File too large to display</strong>
            <p class="mb-0 mt-2">
              This schema file is too large to display in the browser (limit: 200 KB).
              Please use the "Download" button above to download and view it locally.
            </p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  function copyToClipboard() {
    const content = document.getElementById('schema-content').textContent;
    navigator.clipboard.writeText(content).then(function() {
      // Show success feedback
      const btn = event.target.closest('button');
      const originalHTML = btn.innerHTML;
      btn.innerHTML = '<i class="bi bi-check-lg"></i> Copied!';
      btn.classList.remove('btn-outline-secondary');
      btn.classList.add('btn-success');

      setTimeout(function() {
        btn.innerHTML = originalHTML;
        btn.classList.remove('btn-success');
        btn.classList.add('btn-outline-secondary');
      }, 2000);
    }, function(err) {
      alert('Failed to copy to clipboard: ' + err);
    });
  }
</script>
