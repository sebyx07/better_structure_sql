class CreateBetterStructureSqlSchemaVersions < ActiveRecord::Migration<%= migration_version %>
  def change
    create_table :better_structure_sql_schema_versions do |t|
      t.text :content, null: false
      t.string :content_hash, limit: 32, null: false
      t.binary :zip_archive, null: true
      t.string :pg_version, null: false
      t.string :format_type, null: false
      t.string :output_mode, null: false
      t.bigint :content_size, null: false
      t.integer :line_count, null: false
      t.integer :file_count, null: true
      t.timestamp :created_at, null: false
    end

    add_index :better_structure_sql_schema_versions, :created_at, order: { created_at: :desc }
    add_index :better_structure_sql_schema_versions, :content_hash
    add_index :better_structure_sql_schema_versions, :output_mode

    add_check_constraint :better_structure_sql_schema_versions,
                         "format_type IN ('sql', 'rb')",
                         name: 'format_type_check'

    add_check_constraint :better_structure_sql_schema_versions,
                         "output_mode IN ('single_file', 'multi_file')",
                         name: 'output_mode_check'
  end
end
